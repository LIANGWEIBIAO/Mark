## 一. 区分进程和线程
很多开发者是区分不清线程和进程的，没有关系。这很正常。先看看下面这个形象的比喻：    
>进程是一个工厂，工厂有它的独立资源-工厂之间相互独立-线程是工厂中的工人，多个工人协作完成任务-工厂内有一个或多个工人-工人之间共享空间      

如果是windows电脑中，可以打开任务管理器，可以看到有一个后台进程列表。对，那里就是查看进程的地方，而且可以看到每个进程的内存资源信息以及cpu占有率。   
![](https://coding.net/u/lamber0808/p/Mark-Images/git/raw/master/12890819-f63f18ef5513c491.jpg)       

所以，应该更容易理解了：进程是cpu资源分配的最小单位（系统会给它分配内存）

##### 最后，再用较为官方的术语描述一遍：   
- 进程是cpu资源分配的最小单位（是能拥有资源和独立运行的最小单位）
- 线程是cpu调度的最小单位（线程是建立在进程的基础上的一次程序运行单位，一个进程中可以有多个线程）    
   

### 二. 浏览器是多进程的    
#### 理解了进程与线程了区别后，接下来对浏览器进行一定程度上的认识：（先看下简化理解）   
- 浏览器是多进程的
- 浏览器之所以能够运行，是因为系统给它的进程分配了资源（cpu、内存）   
- 简单点理解，每打开一个Tab页，就相当于创建了一个独立的浏览器进程   


关于以上几点的验证，请再第一张图：

![](https://coding.net/u/lamber0808/p/Mark-Images/git/raw/master/12890819-167efc0623b59618.jpg)    

图中打开了Chrome浏览器的多个标签页，然后可以在Chrome的任务管理器中看到有多个进程（分别是每一个Tab页面有一个独立的进程，以及一个主进程）。


### 三、为什么JavaScript是单线程？

JavaScript语言的一大特点就是单线程，也就是说，同一个时间只能做一件事。那么，为什么JavaScript不能有多个线程呢？这样能提高效率啊。

JavaScript的单线程，与它的用途有关。作为浏览器脚本语言，JavaScript的主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？

所以，为了避免复杂性，从一诞生，JavaScript就是单线程，这已经成了这门语言的核心特征，将来也不会改变。   

为了利用多核CPU的计算能力，HTML5提出Web Worker标准，允许JavaScript脚本创建多个线程，但是子线程完全受主线程控制，且不得操作DOM。所以，这个新标准并没有改变JavaScript单线程的本质。    

### 四. JavaScript是单线程，怎样执行异步的代码？

单线程就意味着，所有任务需要排队，前一个任务结束，才会执行后一个任务。如果前一个任务耗时很长，后一个任务就不得不一直等着。
js引擎执行异步代码而不用等待，是因有为有 消息队列和事件循环。
消息队列：消息队列是一个先进先出的队列，它里面存放着各种消息。
事件循环：事件循环是指主线程重复从消息队列中取消息、执行的过程。
实际上，主线程只会做一件事情，就是从消息队列里面取消息、执行消息，再取消息、再执行。当消息队列为空时，就会等待直到消息队列变成非空。而且主线程只有在将当前的消息执行完成后，才会去取下一个消息。这种机制就叫做事件循环机制，取一个消息并执行的过程叫做一次循环。
事件循环用代码表示大概是这样的：

```javascript
while(true) {
    var message = queue.get();
    execute(message);
}
```    
那么，消息队列中放的消息具体是什么东西？消息的具体结构当然跟具体的实现有关，但是为了简单起见，我们可以认为：    
>消息就是注册异步任务时添加的回调函数。 


主线程在发起AJAX请求后，会继续执行其他代码。AJAX线程负责请求,拿到响应后，它会把响应封装成一个JavaScript对象，然后构造一条消息：    
```javascript
// 消息队列中的消息就长这个样子
var message = function () {
    callbackFn(response);
}
```
其中的callbackFn就是前面代码中得到成功响应时的回调函数。    

主线程在执行完当前循环中的所有代码后，就会到消息队列取出这条消息(也就是message函数)，并执行它。到此为止，就完成了工作线程对主线程的通知，回调函数也就得到了执行。如果一开始主线程就没有提供回调函数，AJAX线程在收到HTTP响应后，也就没必要通知主线程，从而也没必要往消息队列放消息。
用图表示这个过程就是：

![](https://coding.net/u/lamber0808/p/Mark-Images/git/raw/master/12890819-bce824083839ea30.jpg)    



[原文作者](./Marklist/NO.05/list-2)  






