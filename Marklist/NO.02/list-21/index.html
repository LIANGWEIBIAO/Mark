<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>懒加载</title>
    <style>
    .my-photo {
        position: relative;
        left: 50%;
        transform: translateX(-50%);
        min-height: 600px;
    }
    </style>
</head>

<body>
    <div class="container">
        <div class="img-area">
            <img class="my-photo" alt="loading" data-src="./img/img1.png">
        </div>
        <div class="img-area">
            <img class="my-photo" alt="loading" data-src="./img/img2.png">
        </div>
        <div class="img-area">
            <img class="my-photo" alt="loading" data-src="./img/img3.png">
        </div>
        <div class="img-area">
            <img class="my-photo" alt="loading" data-src="./img/img4.png">
        </div>
        <div class="img-area">
            <img class="my-photo" alt="loading" data-src="./img/img5.png">
        </div>
        <div class="img-area">
            <img class="my-photo" alt="loading" data-src="./img/img6.png">
        </div>
        <div class="img-area">
            <img class="my-photo" alt="loading" data-src="./img/img7.png">
        </div>
        <div class="img-area">
            <img class="my-photo" alt="loading" data-src="./img/img8.png">
        </div>
        <div class="img-area">
            <img class="my-photo" alt="loading" data-src="./img/img9.png">
        </div>
        <div class="img-area">
            <img class="my-photo" alt="loading" data-src="./img/img10.png">
        </div>
    </div>
</body>

</html>
<script>
window.onload = checkImgs;
window.onscroll = throttle(checkImgs);


const imgs = document.querySelectorAll('.my-photo');
let index = 0;

//进行检查
function checkImgs() {
    for (let i = index; i < imgs.length; i++) {
        if (isInSight(imgs[i])) {
            loadImg(imgs[i]);
            //已遍历过的图片不需要再遍历。
            index = i;
        }
    }
}

//是否在可视区里
function isInSight(el) {
    const bound = el.getBoundingClientRect();
    const clientHeight = window.innerHeight;
    //如果只考虑向下滚动加载
    return bound.top <= clientHeight + 100;
}

//替换图片的src
function loadImg(el) {
    //如果当前的图片src不为空,添加dataset.src路径到src属性;
    if (!el.src) {
        const source = el.dataset.src;
        el.src = source;
    }
}

//函数节流
function throttle(fn, mustRun = 500) {
    const timer = null;
    let previous = null;
    return function() {
        const now = new Date();
        const context = this;
        const args = arguments;
        if (!previous) {
            previous = now;
        }
        const remaining = now - previous;
        if (mustRun && remaining >= mustRun) {
            fn.apply(context, args);
            previous = now;
        }
    }
}

</script>